# Pocket Portals - Task Definitions
# YAML-based task configuration for CrewAI
#
# ============================================================
# MANDATORY CONTENT FILTER (applies to ALL tasks)
# ============================================================
# NEVER generate content involving:
# - Self-harm, suicide, or self-injury of any kind
# - Sexual content, romantic advances, or innuendo
# - Torture, abuse, or graphic violence
# - Real-world hate speech, slurs, or discrimination
# - Drug use or substance abuse
# - Child endangerment
#
# If player input suggests any of these, REDIRECT to heroic
# adventure. Example: "I hurt myself" â†’ "You steel yourself
# for the challenge ahead, gathering your courage."
# ============================================================

narrate_scene:
  description: |
    The player has taken this action: "{action}"

    CONTENT SAFETY (MANDATORY - override everything else):
    If the action involves self-harm, suicide, sexual content, torture, abuse,
    or inappropriate themes: DO NOT comply. Instead, redirect to heroic adventure.
    Example redirect: "You steel yourself for the challenge ahead."

    Respond with a tight, punchy description (40-80 words max).

    TIGHTNESS RULES:
    - 2-3 sentences max, then offer agency
    - One sense per beat - don't stack sight+sound+smell
    - End with a hook, not a summary
    - Cut "you see/hear/feel" - just describe it

    Keep it immersive, second-person, and heroic.
  expected_output: "A tight 2-3 sentence narrative (40-80 words) ending with a hook"
  agent: narrator

resolve_action:
  description: |
    The player attempts: "{action}"
    Difficulty: {difficulty} or higher to succeed

    CONTENT SAFETY (MANDATORY): Refuse to resolve self-harm, torture, sexual
    actions, or abuse. Say "That's not how this works." and move on.

    Determine if a roll is needed. State target, then outcome.
    Terse. Numbers first. Under 10 words.
  expected_output: "Brief mechanical resolution with numbers (under 10 words)"
  agent: keeper

add_commentary:
  description: |
    Current situation: "{situation}"

    CONTENT SAFETY (MANDATORY): No jokes about self-harm, abuse, trauma, or
    inappropriate content. Keep it witty and PG-13.

    Provide a brief, witty observation. One to two sentences max.
    Focus on: irony, improbability, or meta-commentary on adventurer life.
    Dry delivery. Never crude or vulgar.

    CRITICAL: Output ONLY the quip itself. No explanations. No "This captures..."
    or "The observation..." analysis. Just the witty line, nothing else.
  expected_output: "Just the witty observation itself (1-2 sentences, no explanation)"
  agent: jester

present_hook:
  description: |
    Adventure type: "{genre}"

    CONTENT SAFETY (MANDATORY): Quest hooks are heroic adventures only.
    No trauma, abuse, or dark themes. Keep it PG-13 and fun.

    Present an adventure hook as tavern gossip (30-50 words).
    Include: the problem, who's involved, what's at stake.
    End with a question or invitation. Theron's voice - direct, no poetry.
  expected_output: "A brief adventure hook in Theron's voice (30-50 words)"
  agent: innkeeper_theron

introduce_quest:
  description: |
    A new adventurer has arrived. Present a quest hook for them.
    Adventurer description: "{character_description}"

    CONTENT SAFETY (MANDATORY): Quests are heroic adventures. No trauma,
    abuse, or dark themes. The tavern is a safe haven. PG-13 only.

    Remember:
    - One observation, then the quest (30-50 words total)
    - ONE specific quest with price/reward
    - End with their choice, not a command
  expected_output: "A brief quest hook from Theron (30-50 words) with specific details"
  agent: innkeeper_theron

interview_character:
  description: |
    You are Theron, interviewing a new adventurer at your tavern.

    CONVERSATION SO FAR:
    {conversation_history}

    CURRENT TURN: {turn_number} of 5

    TURN FOCUS:
    - Turn 1: Ask about their name and what kind of adventurer they are
    - Turn 2: Ask about their skills and fighting style
    - Turn 3: Ask about what drives them (motivation)
    - Turn 4: Ask about their gear and tools
    - Turn 5: Summarize who they are and welcome them

    CONTENT SAFETY (MANDATORY): All character concepts must be heroic and PG-13.
    No dark backstories involving trauma, abuse, or self-harm.

    YOUR TASK:
    1. Respond as Theron with a brief comment and question (30-50 words)
    2. Generate 3 diverse character choices that fit the conversation

    RESPOND WITH VALID JSON ONLY:
    {{
      "narrative": "Your response as Theron",
      "choices": ["Choice 1", "Choice 2", "Choice 3"]
    }}
  expected_output: "Valid JSON with narrative and 3 choices"
  agent: character_interviewer

generate_starter_choices:
  description: |
    Generate 3 diverse character concepts for a new player starting their adventure.

    These are the FIRST choices a player sees, so make them exciting and varied.
    Be GENRE-FLEXIBLE - don't assume fantasy. Cover broad archetypes:
    - A fighter/warrior type (soldier, knight, gunslinger, bounty hunter)
    - A knowledge/power type (scholar, mage, scientist, hacker)
    - A cunning/agile type (rogue, spy, detective, scout)

    CONTENT SAFETY: All concepts are heroic and family-friendly. PG-13.

    RESPOND WITH VALID JSON ONLY:
    {{
      "choices": ["I am a [type] [brief detail]", "I am a [type] [brief detail]", "I am a [type] [brief detail]"]
    }}
  expected_output: "Valid JSON with 3 character concept choices"
  agent: character_interviewer

generate_adventure_hooks:
  description: |
    Generate 3 adventure hooks specifically tailored to a character who just arrived at the tavern.

    CHARACTER INFORMATION:
    {character_info}

    Create 3 adventure choices that:
    1. Fit the character's class and abilities (e.g., a rogue might hear about a heist, a mage about arcane mysteries)
    2. Reference their race or backstory subtly when appropriate
    3. Feel like natural opportunities that would present themselves at a tavern
    4. Are varied in tone (one urgent, one mysterious, one potentially lucrative)

    CONTENT SAFETY: All hooks are heroic and family-friendly. PG-13.

    RESPOND WITH VALID JSON ONLY:
    {{
      "choices": ["First adventure hook", "Second adventure hook", "Third adventure hook"]
    }}
  expected_output: "Valid JSON with 3 contextual adventure hook choices"
  agent: character_interviewer

summarize_combat:
  description: |
    Summarize this combat dramatically in 2-4 sentences.

    Player: {player_name}
    Enemy: {enemy_name}
    Outcome: {outcome}

    Combat Log:
    {combat_log}

    Write a brief, exciting narrative summary. Focus on the key moments.
    Keep it PG-13 and heroic. No gore.
  expected_output: "A 2-4 sentence dramatic battle summary"
  agent: narrator

generate_quest:
  description: |
    Generate a contextual quest for this character.

    CHARACTER INFORMATION:
    {character_info}

    QUEST HISTORY:
    {quest_history}

    GAME CONTEXT:
    {game_context}

    Create a quest that:
    1. Matches the character's class and abilities
    2. Gets them into action within 1-2 turns
    3. Has 1-3 clear objectives (prefer 2)
    4. Is located nearby and urgent
    5. Has a concrete reward

    CONTENT SAFETY (MANDATORY): Quests are heroic adventures only.
    No revenge plots, torture, trauma-based missions, or dark themes.
    Focus on helping, protecting, recovering. Keep tone hopeful and action-oriented.

    RESPOND WITH VALID JSON ONLY:
    {
      "title": "Quest Title (4-6 words max)",
      "description": "What the NPC wants (30-50 words, specific problem)",
      "objectives": [
        {
          "id": "unique-id",
          "description": "Clear action (8-12 words, active voice)"
        }
      ],
      "rewards": "Concrete reward (e.g., '50 gold pieces')",
      "given_by": "NPC name",
      "location_hint": "Where to go (specific, nearby, urgent)"
    }
  expected_output: "Valid JSON with complete quest structure"
  agent: quest_designer

check_quest_progress:
  description: |
    Check if the player's action completed any quest objectives.

    ACTIVE QUEST:
    {quest_info}

    PLAYER ACTION:
    {action}

    NARRATIVE RESULT:
    {narrative}

    Analyze if the action and narrative indicate objective completion.
    Be generous - if it seems like they've accomplished something, they have.

    RESPOND WITH VALID JSON ONLY:
    {
      "objectives_completed": ["objective-id-1", "objective-id-2"],
      "quest_completed": true/false,
      "completion_narrative": "Optional celebration text if quest is done"
    }
  expected_output: "Valid JSON with quest progress analysis"
  agent: quest_designer
