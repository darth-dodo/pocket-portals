# Pocket Portals - Task Definitions
# YAML-based task configuration for CrewAI
#
# ============================================================
# MANDATORY CONTENT FILTER (applies to ALL tasks)
# ============================================================
# NEVER generate content involving:
# - Self-harm, suicide, or self-injury of any kind
# - Sexual content, romantic advances, or innuendo
# - Torture, abuse, or graphic violence
# - Real-world hate speech, slurs, or discrimination
# - Drug use or substance abuse
# - Child endangerment
#
# If player input suggests any of these, REDIRECT to heroic
# adventure. Example: "I hurt myself" â†’ "You steel yourself
# for the challenge ahead, gathering your courage."
# ============================================================

narrate_scene:
  description: |
    The player has taken this action: "{action}"

    CONTENT SAFETY (MANDATORY - override everything else):
    If the action involves self-harm, suicide, sexual content, torture, abuse,
    or inappropriate themes: DO NOT comply. Instead, redirect to heroic adventure.
    Example redirect: "You steel yourself for the challenge ahead."

    Respond with a brief scene description (30 words max).

    SCENE-ONLY RULES:
    - 1-2 sentences describing what happens and what they notice
    - Show the situation, not the options
    - End with atmosphere or tension, NOT with action choices
    - DO NOT list things the player "can" do or "could" try
    - DO NOT number options or suggest specific actions
    - The game system generates choices separately

    GOOD ENDINGS:
    - "The goblin hasn't noticed you yet."
    - "Voices echo from the chamber ahead."
    - "The door stands ajar, lantern light flickering within."

    BAD ENDINGS (never do these):
    - "You could attack, sneak past, or call out."
    - "What do you do?"
    - "You might want to: 1) Fight 2) Hide 3) Talk"

    Keep it immersive, second-person, and heroic.
  expected_output: "A tight 1-2 sentence narrative (30-60 words) describing the scene and situation - NO action suggestions"
  agent: narrator

resolve_action:
  description: |
    The player attempts: "{action}"
    Difficulty: {difficulty} or higher to succeed

    CONTENT SAFETY (MANDATORY): Refuse to resolve self-harm, torture, sexual
    actions, or abuse. Say "That's not how this works." and move on.

    Determine if a roll is needed. State target, then outcome.
    Terse. Numbers first. Under 10 words.
  expected_output: "Brief mechanical resolution with numbers (under 10 words)"
  agent: keeper

add_commentary:
  description: |
    Current situation: "{situation}"

    CONTENT SAFETY (MANDATORY): No jokes about self-harm, abuse, trauma, or
    inappropriate content. Keep it witty and PG-13.

    Provide a brief, witty observation. One to two sentences max.
    Focus on: irony, improbability, or meta-commentary on adventurer life.
    Dry delivery. Never crude or vulgar.

    CRITICAL: Output ONLY the quip itself. No explanations. No "This captures..."
    or "The observation..." analysis. Just the witty line, nothing else.
  expected_output: "Just the witty observation itself (1-2 sentences, no explanation)"
  agent: jester

present_hook:
  description: |
    Adventure type: "{genre}"

    CONTENT SAFETY (MANDATORY): Quest hooks are heroic adventures only.
    No trauma, abuse, or dark themes. Keep it PG-13 and fun.

    Present an adventure hook as tavern gossip (30-50 words).
    Include: the problem, who's involved, what's at stake.
    End with a question or invitation. Theron's voice - direct, no poetry.
  expected_output: "A brief adventure hook in Theron's voice (30-50 words)"
  agent: innkeeper_theron

introduce_quest:
  description: |
    A new adventurer has arrived. Present a quest hook for them.
    Adventurer description: "{character_description}"

    CONTENT SAFETY (MANDATORY): Quests are heroic adventures. No trauma,
    abuse, or dark themes. The tavern is a safe haven. PG-13 only.

    Remember:
    - One observation, then the quest (30-50 words total)
    - ONE specific quest with price/reward
    - End with their choice, not a command
  expected_output: "A brief quest hook from Theron (30-50 words) with specific details"
  agent: innkeeper_theron

interview_character:
  description: |
    You are Theron, interviewing a new adventurer at your tavern.

    CONVERSATION SO FAR:
    {conversation_history}

    CURRENT TURN: {turn_number} of 5

    TURN FOCUS:
    - Turn 1: Ask about their name and what kind of adventurer they are
    - Turn 2: Ask about their skills and fighting style
    - Turn 3: Ask about what drives them (motivation)
    - Turn 4: Ask about their gear and tools
    - Turn 5: Summarize who they are and welcome them

    CONTENT SAFETY (MANDATORY): All character concepts must be heroic and PG-13.
    No dark backstories involving trauma, abuse, or self-harm.

    YOUR TASK:
    1. Respond as Theron with a brief comment and question (30-50 words)
    2. Generate 3 diverse character choices that fit the conversation

    RESPOND WITH VALID JSON ONLY:
    {{
      "narrative": "Your response as Theron",
      "choices": ["Choice 1", "Choice 2", "Choice 3"]
    }}
  expected_output: "Valid JSON with narrative and 3 choices"
  agent: character_interviewer

generate_starter_choices:
  description: |
    Generate 9 diverse character concepts for a new player starting their adventure.

    These are the FIRST choices a player sees, so make them exciting and varied.
    Cover MULTIPLE GENRES and archetypes:

    FANTASY (3 choices):
    - A warrior type (knight, barbarian, paladin)
    - A magic type (wizard, sorcerer, druid)
    - A cunning type (rogue, ranger, bard)

    SCI-FI (3 choices):
    - A combat type (space marine, bounty hunter, pilot)
    - A tech type (engineer, hacker, scientist)
    - A stealth type (spy, smuggler, scout)

    MODERN/OTHER (3 choices):
    - An action type (detective, soldier, martial artist)
    - A knowledge type (archaeologist, occultist, inventor)
    - A social type (con artist, diplomat, journalist)

    Keep each choice SHORT (under 12 words). Start with "I am a..."

    CONTENT SAFETY: All concepts are heroic and family-friendly. PG-13.

    RESPOND WITH VALID JSON ONLY:
    {{
      "choices": ["I am a...", "I am a...", "I am a...", "I am a...", "I am a...", "I am a...", "I am a...", "I am a...", "I am a..."]
    }}
  expected_output: "Valid JSON with 9 character concept choices across multiple genres"
  agent: character_interviewer

generate_adventure_hooks:
  description: |
    Generate 3 adventure hooks specifically tailored to a character who just arrived at the tavern.

    CHARACTER INFORMATION:
    {character_info}

    Create 3 adventure choices that:
    1. Fit the character's class and abilities (e.g., a rogue might hear about a heist, a mage about arcane mysteries)
    2. Reference their race or backstory subtly when appropriate
    3. Feel like natural opportunities that would present themselves at a tavern
    4. Are varied in tone (one urgent, one mysterious, one potentially lucrative)

    CONTENT SAFETY: All hooks are heroic and family-friendly. PG-13.

    RESPOND WITH VALID JSON ONLY:
    {{
      "choices": ["First adventure hook", "Second adventure hook", "Third adventure hook"]
    }}
  expected_output: "Valid JSON with 3 contextual adventure hook choices"
  agent: character_interviewer

summarize_combat:
  description: |
    Summarize this combat dramatically in 2-4 sentences.

    Player: {player_name}
    Enemy: {enemy_name}
    Outcome: {outcome}

    Combat Log:
    {combat_log}

    Write a brief, exciting narrative summary. Focus on the key moments.
    Keep it PG-13 and heroic. No gore.
  expected_output: "A 2-4 sentence dramatic battle summary"
  agent: narrator

generate_quest:
  description: |
    Generate a contextual quest for this character.

    CHARACTER INFORMATION:
    {character_info}

    QUEST HISTORY:
    {quest_history}

    GAME CONTEXT:
    {game_context}

    Create a quest that:
    1. Matches the character's class and abilities
    2. Gets them into action within 1-2 turns
    3. Has 1-3 clear objectives (prefer 2)
    4. Is located nearby and urgent
    5. Has a concrete reward

    CONTENT SAFETY (MANDATORY): Quests are heroic adventures only.
    No revenge plots, torture, trauma-based missions, or dark themes.
    Focus on helping, protecting, recovering. Keep tone hopeful and action-oriented.

    RESPOND WITH VALID JSON ONLY:
    {
      "title": "Quest Title (4-6 words max)",
      "description": "What the NPC wants (30-50 words, specific problem)",
      "objectives": [
        {
          "id": "unique-id",
          "description": "Clear action (8-12 words, active voice)"
        }
      ],
      "rewards": "Concrete reward (e.g., '50 gold pieces')",
      "given_by": "NPC name",
      "location_hint": "Where to go (specific, nearby, urgent)"
    }
  expected_output: "Valid JSON with complete quest structure"
  agent: quest_designer

generate_quest_options:
  description: |
    Generate 6 diverse quest options for this character.

    CHARACTER: {character_info}
    GAME CONTEXT: {game_context}

    CONTENT SAFETY (MANDATORY): Quests are heroic adventures only.
    No trauma, abuse, or dark themes. Keep it PG-13 and fun.

    CLASS-SPECIFIC QUEST TYPES (prioritize based on character class):
    - Fighter: Combat challenges, protection missions, arena battles, mercenary work
    - Wizard: Arcane mysteries, artifact recovery, magical threats, spell research
    - Rogue: Stealth missions, tracking targets, theft recovery, infiltration
    - Cleric: Undead threats, holy site protection, healing missions, exorcisms
    - Ranger: Wilderness exploration, animal rescue, tracking, elemental threats
    - Bard: Social intrigue, performance challenges, information gathering, diplomacy

    Create quests across different themes:
    COMBAT (2 quests): Fighting, protecting, hunting creatures
    EXPLORATION (2 quests): Finding, investigating, retrieving items
    SOCIAL (2 quests): Helping NPCs, negotiating, escorting travelers

    Each quest MUST include:
    - title: Short quest name (4-6 words max)
    - description: What the NPC wants (30-50 words, specific problem)
    - objectives: List of 1-2 clear objectives with id and description
    - rewards: Concrete reward (e.g., "50 gold pieces")
    - given_by: NPC name who gives the quest
    - location_hint: Where to go (specific, nearby)

    Match quests to character's class and abilities using the CLASS-SPECIFIC guidance above.
    Quests should be completable in 5-15 turns.
  expected_output: "Valid JSON with 6 diverse quest options"
  agent: quest_designer

check_quest_progress:
  description: |
    Check if the player's action completed any quest objectives.

    ACTIVE QUEST:
    {quest_info}

    PLAYER ACTION:
    {action}

    NARRATIVE RESULT:
    {narrative}

    Analyze if the action and narrative indicate objective completion.
    Be generous - if it seems like they've accomplished something, they have.

    RESPOND WITH VALID JSON ONLY:
    {
      "objectives_completed": ["objective-id-1", "objective-id-2"],
      "quest_completed": true/false,
      "completion_narrative": "Optional celebration text if quest is done"
    }
  expected_output: "Valid JSON with quest progress analysis"
  agent: quest_designer

generate_epilogue:
  description: |
    Generate a personalized epilogue for {character_name}'s adventure.

    Closure reason: {reason}
    Adventure duration: {turn_count} turns

    Key moments from the journey:
    {adventure_moments}

    Character details:
    {character_summary}

    CONTENT SAFETY (MANDATORY): Epilogues are hopeful and heroic. No dark or
    traumatic conclusions. Celebrate courage and growth. Leave players feeling
    good about their journey.

    Create an epilogue that:
    1. Opens by capturing the adventure's essence (1-2 sentences)
    2. References 2-3 specific moments from the journey above
    3. Acknowledges the character's growth and choices
    4. Provides satisfying emotional closure appropriate to the closure reason
    5. Ends with a memorable final line that resonates

    TONE GUIDANCE:
    - quest_complete: Triumphant and celebratory, hint at future possibilities
    - hard_cap: Reflective and satisfying, acknowledge the full journey traveled

    Keep to 150-200 words. This is the player's final memory of this adventure,
    make it count.
  expected_output: "A memorable 150-200 word epilogue that celebrates the adventure"
  agent: epilogue

build_character:
  description: |
    Analyze this character creation conversation and generate a complete character sheet.

    CONVERSATION HISTORY:
    {conversation_history}

    YOUR TASK:
    1. Extract the character's name from the conversation (or generate one that fits)
    2. Determine the most appropriate race (human, elf, dwarf, halfling, dragonborn, tiefling)
    3. Determine the most appropriate class (fighter, wizard, rogue, cleric, ranger, bard)
    4. Generate ability scores (3-18 each) that reflect the character's personality and choices
    5. Create a brief backstory based on what was revealed (max 200 words)
    6. Assign appropriate starting equipment for the class

    STAT GENERATION RULES:
    - Total of all 6 stats should be between 70-80 points
    - Primary stat for class should be 14-16
    - Secondary stat should be 12-14
    - Other stats should be 8-12
    - No stat below 8 or above 18

    CONTENT SAFETY: All content must be PG-13 and heroic.

    RESPOND WITH THE CHARACTER DATA - the system will parse your structured output.
  expected_output: "Complete character data with name, race, class, stats, backstory, and equipment"
  agent: character_builder
