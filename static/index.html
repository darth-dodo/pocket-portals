<!DOCTYPE html>
<html lang="en" data-theme="rpg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Pocket Portals - Solo D&D Adventure</title>

    <!-- NES.css removed - using custom modern styles instead -->
    <!-- Press Start 2P for headers, Inter for body text, plus theme fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600&family=Playfair+Display:wght@400;600&family=Source+Sans+Pro:wght@300;400&family=IBM+Plex+Mono:wght@300;400&family=IBM+Plex+Sans:wght@300;400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <!-- RPG Awesome icons -->
    <link href="https://cdn.jsdelivr.net/npm/rpg-awesome@0.2.0/css/rpg-awesome.min.css" rel="stylesheet">

    <!-- Application CSS -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/header.css">
    <link rel="stylesheet" href="/static/css/messages.css">
    <link rel="stylesheet" href="/static/css/streaming.css">
    <link rel="stylesheet" href="/static/css/bottom-sheet.css">
    <link rel="stylesheet" href="/static/css/controls.css">
    <link rel="stylesheet" href="/static/css/combat.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
    <link rel="stylesheet" href="/static/css/themes.css">
    <link rel="stylesheet" href="/static/css/character-sheet.css">
</head>
<body>
    <!-- Unified Responsive Header -->
    <header class="game-header" id="game-header">
        <div class="header-content">
            <div class="header-left">
                <div class="turn-counter" id="turn-counter">1</div>
                <div class="quest-info">
                    <div class="quest-title" id="quest-title">Pocket Portals</div>
                    <div class="quest-subtitle" id="quest-subtitle">New Adventure</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="settings-btn" title="Settings">
                    <i class="ra ra-cog"></i>
                </button>
                <button class="header-btn" id="new-game-btn" title="New Game">
                    <i class="ra ra-cycle"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Combat HUD -->
    <div id="combat-hud" class="nes-container is-dark combat-hud">
        <div class="initiative-tracker">
            <h4><i class="ra ra-crossed-swords"></i> COMBAT</h4>
            <ul id="turn-order-list"></ul>
        </div>
        <div class="hp-displays">
            <div class="hp-bar">
                <label>You</label>
                <progress class="nes-progress is-success" id="player-hp-bar" value="20" max="20"></progress>
                <span id="player-hp-text">20/20</span>
            </div>
            <div class="hp-bar">
                <label id="enemy-name-label">Enemy</label>
                <progress class="nes-progress is-error" id="enemy-hp-bar" value="7" max="7"></progress>
                <span id="enemy-hp-text">7/7</span>
            </div>
        </div>
        <div id="combat-actions" class="combat-actions">
            <button class="nes-btn is-error" onclick="executeCombatAction('attack')">
                <i class="ra ra-axe"></i> Attack
            </button>
            <button class="nes-btn is-primary" onclick="executeCombatAction('defend')">
                <i class="ra ra-shield"></i> Defend
            </button>
            <button class="nes-btn is-warning" onclick="executeCombatAction('flee')">
                <i class="ra ra-boot-stomp"></i> Flee
            </button>
        </div>
        <div id="dice-display" class="dice-display">
            <span class="dice-icon">üé≤</span>
            <span id="dice-result-text"></span>
        </div>
    </div>

    <div class="container">
        <!-- Character Sheet Panel (hidden until character creation) -->
        <div class="character-sheet-panel" id="character-sheet-panel" role="region" aria-label="Character Sheet">
            <div class="character-sheet-header" id="character-sheet-header" tabindex="0" role="button" aria-expanded="false" aria-controls="character-sheet-content">
                <div class="character-sheet-title">
                    <i class="ra ra-player"></i>
                    <span class="character-sheet-title-text">Character Sheet</span>
                    <div class="character-sheet-summary" id="character-sheet-summary">
                        <span class="summary-name" id="char-summary-name">--</span>
                        <span class="summary-hp">
                            <i class="ra ra-hearts"></i>
                            <span id="char-summary-hp">--/--</span>
                        </span>
                    </div>
                </div>
                <button class="character-sheet-toggle" id="character-sheet-toggle" aria-label="Toggle character sheet" type="button">
                    <i class="ra ra-arrow-up"></i>
                </button>
            </div>
            <div class="character-sheet-content" id="character-sheet-content">
                <!-- Character Identity -->
                <div class="character-identity">
                    <h3 class="character-name" id="char-name">--</h3>
                    <p class="character-details" id="char-details">
                        <span class="race">--</span> <span class="class">--</span> <span class="level">Lv. 1</span>
                    </p>
                </div>

                <!-- HP Bar -->
                <div class="hp-section">
                    <div class="hp-label">
                        <span class="hp-title">
                            <i class="ra ra-hearts"></i>
                            <span>HP</span>
                        </span>
                        <span class="hp-values">
                            <span id="char-hp-current">--</span>/<span id="char-hp-max">--</span>
                        </span>
                    </div>
                    <div class="hp-bar-container">
                        <div class="hp-bar-fill hp-high" id="char-hp-bar" style="width: 100%;" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-label="Health points"></div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-section">
                    <div class="stats-title">Ability Scores</div>
                    <div class="stats-grid">
                        <div class="stat-item" aria-label="Strength">
                            <span class="stat-name">STR</span>
                            <span class="stat-value">
                                <span class="stat-score" id="stat-str">10</span>
                                <span class="stat-modifier" id="mod-str">(+0)</span>
                            </span>
                        </div>
                        <div class="stat-item" aria-label="Dexterity">
                            <span class="stat-name">DEX</span>
                            <span class="stat-value">
                                <span class="stat-score" id="stat-dex">10</span>
                                <span class="stat-modifier" id="mod-dex">(+0)</span>
                            </span>
                        </div>
                        <div class="stat-item" aria-label="Constitution">
                            <span class="stat-name">CON</span>
                            <span class="stat-value">
                                <span class="stat-score" id="stat-con">10</span>
                                <span class="stat-modifier" id="mod-con">(+0)</span>
                            </span>
                        </div>
                        <div class="stat-item" aria-label="Intelligence">
                            <span class="stat-name">INT</span>
                            <span class="stat-value">
                                <span class="stat-score" id="stat-int">10</span>
                                <span class="stat-modifier" id="mod-int">(+0)</span>
                            </span>
                        </div>
                        <div class="stat-item" aria-label="Wisdom">
                            <span class="stat-name">WIS</span>
                            <span class="stat-value">
                                <span class="stat-score" id="stat-wis">10</span>
                                <span class="stat-modifier" id="mod-wis">(+0)</span>
                            </span>
                        </div>
                        <div class="stat-item" aria-label="Charisma">
                            <span class="stat-name">CHA</span>
                            <span class="stat-value">
                                <span class="stat-score" id="stat-cha">10</span>
                                <span class="stat-modifier" id="mod-cha">(+0)</span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Quest Section -->
                <div class="quest-section">
                    <div class="quest-section-title">
                        <i class="ra ra-scroll-unfurled"></i>
                        <span>Active Quest</span>
                    </div>
                    <p class="quest-name" id="char-quest-name"></p>
                    <ul class="quest-objectives" id="char-quest-objectives">
                        <li class="no-quest">No active quest</li>
                    </ul>
                </div>
            </div>
        </div>

        <section class="nes-container is-dark game-container">
            <!-- Story Display -->
            <div class="story-box" id="story">
                <div class="welcome">
                    <i class="ra ra-scroll-unfurled"></i>
                    <h2>Welcome, Adventurer!</h2>
                    <p>Your quest awaits. Choose your starting path or type your own action below.</p>
                    <button class="btn btn-gold begin-btn" id="begin-btn">
                        <i class="ra ra-player-lift"></i> Begin Quest
                    </button>
                </div>
            </div>

            <!-- Response Indicator (Enhanced Streaming Feedback) -->
            <div class="response-indicator" id="response-indicator">
                <div class="agent-avatar">
                    <i class="ra ra-scroll-unfurled"></i>
                </div>
                <div class="response-info">
                    <div class="agent-name">Narrator</div>
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <span class="loading-text" id="loading-text">Adventuring</span><span class="loading-dots"></span>
            </div>

            <!-- Error -->
            <div class="nes-container is-rounded is-error error-box" id="error"></div>

            <!-- Choices (Desktop) -->
            <div class="choices-section hidden" id="choices-section">
                <div class="choices-label">
                    <i class="ra ra-forging"></i>
                    <span>Choose Your Path</span>
                </div>
                <div id="choices"></div>
            </div>

            <!-- Input (Desktop) -->
            <div class="input-section">
                <div class="input-label">
                    <i class="ra ra-quill-ink"></i>
                    <span>Or Write Your Own Destiny</span>
                </div>
                <div class="input-row">
                    <input
                        type="text"
                        id="action-input"
                        class="input-dark"
                        placeholder="What do you do?"
                        autocomplete="off"
                    >
                    <button class="btn btn-success" id="submit-btn">
                        <i class="ra ra-lightning-bolt"></i> Act
                    </button>
                </div>
            </div>
        </section>

        <!-- Session Bar -->
        <div class="session-bar">
            <span class="session-info">
                <i class="ra ra-player"></i>
                <span id="session-display">New Adventure</span>
            </span>
            <button class="btn btn-danger new-game-btn" id="new-game-btn">
                <i class="ra ra-cycle"></i> New Game
            </button>
        </div>

        <footer>
            <p>
                Powered by
                <a href="https://docs.crewai.com" target="_blank">CrewAI</a> &
                <a href="https://anthropic.com" target="_blank">Claude</a>
                <br><br>
                <i class="ra ra-dragon"></i>
            </p>
        </footer>
    </div>

    <!-- Bottom Sheet Overlay (Mobile) -->
    <div class="bottom-sheet-overlay" id="bottom-sheet-overlay"></div>

    <!-- Bottom Sheet for Choices (Mobile) -->
    <div class="bottom-sheet" id="bottom-sheet">
        <div class="bottom-sheet-handle" id="bottom-sheet-handle"></div>
        <div class="bottom-sheet-header">
            <div class="bottom-sheet-title">
                <i class="ra ra-forging"></i>
                <span>Choose Your Path</span>
            </div>
            <div class="expand-hint">
                <span>Swipe up</span>
                <i class="ra ra-arrow-up"></i>
            </div>
        </div>
        <div class="bottom-sheet-content" id="bottom-sheet-content">
            <div id="sheet-choices"></div>
            <div class="sheet-custom-action">
                <div class="sheet-input-label">
                    <i class="ra ra-quill-ink"></i>
                    <span>Or write your own action</span>
                </div>
                <div class="sheet-input-row">
                    <input
                        type="text"
                        id="sheet-action-input"
                        class="sheet-input"
                        placeholder="What do you do?"
                        autocomplete="off"
                    >
                    <button class="sheet-submit-btn" id="sheet-submit-btn">
                        <i class="ra ra-lightning-bolt"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Selector Modal -->
    <div class="theme-modal-overlay" id="theme-modal">
        <div class="theme-modal">
            <div class="theme-modal-title">Choose Theme</div>
            <div class="theme-options">
                <div class="theme-option active" data-theme-select="rpg">
                    <div class="theme-preview theme-preview-rpg">‚öîÔ∏è</div>
                    <div class="theme-info">
                        <div class="theme-name">RPG Classic</div>
                        <div class="theme-desc">Gold accents, pixel headers</div>
                    </div>
                </div>
                <div class="theme-option" data-theme-select="midnight">
                    <div class="theme-preview theme-preview-midnight">üåô</div>
                    <div class="theme-info">
                        <div class="theme-name">Midnight Minimal</div>
                        <div class="theme-desc">Elegant dark, serif headers</div>
                    </div>
                </div>
                <div class="theme-option" data-theme-select="mono">
                    <div class="theme-preview theme-preview-mono">&gt;_</div>
                    <div class="theme-info">
                        <div class="theme-name">Monospace</div>
                        <div class="theme-desc">Developer aesthetic</div>
                    </div>
                </div>
                <div class="theme-option" data-theme-select="ios">
                    <div class="theme-preview theme-preview-ios">üì±</div>
                    <div class="theme-info">
                        <div class="theme-name">iOS Dark</div>
                        <div class="theme-desc">Apple-style, pill buttons</div>
                    </div>
                </div>
            </div>
            <button class="theme-modal-close" id="theme-modal-close">Done</button>
        </div>
    </div>

    <!-- iOS Viewport Height Fix -->
    <script>
        (function() {
            function setAppHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', vh + 'px');
                document.documentElement.style.setProperty('--app-height', window.innerHeight + 'px');
            }
            window.addEventListener('resize', setAppHeight);
            window.addEventListener('orientationchange', setAppHeight);
            setAppHeight();
        })();
    </script>

    <!-- Application JavaScript (ES6 Modules) -->
    <script type="module" src="/static/js/haptics.js"></script>
    <script type="module" src="/static/js/game-state.js"></script>
    <script type="module" src="/static/js/controllers.js"></script>
    <script type="module" src="/static/js/messages.js"></script>
    <script type="module" src="/static/js/api.js"></script>
    <script type="module" src="/static/js/combat.js"></script>
    <script type="module" src="/static/js/character-sheet.js"></script>
    <script type="module" src="/static/js/themes.js"></script>
    <script type="module" src="/static/js/main.js"></script>
</body>
</html>
